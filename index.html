<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>wList - –ö–∞—Ä—Ç–æ—á–∫–∏</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3ClinearGradient id='giftGrad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%23ff6b9d;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%23c44569;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect x='20' y='35' width='60' height='50' fill='url(%23giftGrad)' rx='5'/%3E%3Crect x='20' y='35' width='60' height='15' fill='%23ffd700' rx='5'/%3E%3Cline x1='50' y1='35' x2='50' y2='85' stroke='%23fff' stroke-width='3'/%3E%3Cline x1='20' y1='50' x2='80' y2='50' stroke='%23fff' stroke-width='3'/%3E%3Ccircle cx='35' cy='25' r='8' fill='%23ff6b9d'/%3E%3Ccircle cx='65' cy='25' r='8' fill='%23ff6b9d'/%3E%3Cpath d='M 35 25 Q 50 15 65 25' stroke='%23ff6b9d' stroke-width='2' fill='none'/%3E%3C/svg%3E">
    <style>
        :root {
            --bg-color: #1a1a1a;
            --card-bg: #2d2d2d;
            --text-color: #e0e0e0;
            --accent-color: #4a76fd;
            --hover-color: #3a66ed;
            --danger-color: #e74c3c;
            --border-radius: 8px;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            --legendary-color: #ffd700;
            --epic-color: #9b59b6;
            --rare-color: #3498db;
            --uncommon-color: #2ecc71;
            --common-color: #95a5a6;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 2rem;
            background-color: var(--card-bg);
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--text-color);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .logo-icon {
            width: 28px;
            height: 28px;
            flex-shrink: 0;
        }

        .header-buttons {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .status-filter-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .status-filter-btn {
            background: none;
            border: none;
            color: var(--text-color);
            cursor: pointer;
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius);
            transition: background-color 0.3s;
            position: relative;
        }

        .status-filter-btn:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .status-filter-btn.active {
            background-color: var(--accent-color);
        }

        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 0.5rem;
        }

        .status-indicator.active {
            background-color: #ffd700;
        }

        .status-indicator.completed {
            background-color: #2ecc71;
        }

        .status-indicator.abandoned {
            background-color: #95a5a6;
        }

        .hidden-btn {
            background: none;
            border: none;
            width: 40px;
            height: 40px;
            cursor: default;
            opacity: 0;
            position: relative;
            margin-left: 0.5rem;
            pointer-events: auto;
        }

        .header-btn {
            background: none;
            border: none;
            color: var(--text-color);
            cursor: pointer;
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius);
            transition: background-color 0.3s;
        }

        .header-btn:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        main {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        .category-section {
            margin-bottom: 2rem;
        }

        .category-header {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .category-total {
            font-size: 0.9rem;
            font-weight: normal;
            opacity: 0.7;
        }

        .category-header.legendary {
            color: var(--legendary-color);
        }

        .category-header.epic {
            color: var(--epic-color);
        }

        .category-header.rare {
            color: var(--rare-color);
        }

        .category-header.uncommon {
            color: var(--uncommon-color);
        }

        .category-header.common {
            color: var(--common-color);
        }

        .cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1.5rem;
            width: 100%;
        }

        .card {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: transform 0.3s, box-shadow 0.3s;
            position: relative;
            aspect-ratio: 1;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
        }

        .card-link {
            display: block;
            width: 100%;
            height: 100%;
            text-decoration: none;
            color: inherit;
        }

        .card-add {
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 2px dashed rgba(255, 255, 255, 0.3);
        }

        .card-add:hover {
            border-color: var(--accent-color);
        }

        .plus-icon {
            font-size: 3rem;
            color: rgba(255, 255, 255, 0.5);
        }

        .card-add:hover .plus-icon {
            color: var(--accent-color);
        }

        .card-image {
            width: 100%;
            height: 70%;
            object-fit: cover;
        }

        .card-title {
            padding: 1rem;
            font-weight: 500;
            height: 30%;
            display: flex;
            align-items: center;
            overflow: hidden;
            text-overflow: ellipsis;
            gap: 0.5rem;
        }

        .card-status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .card-status-dot.active {
            background-color: #ffd700;
        }

        .card-status-dot.completed {
            background-color: #2ecc71;
        }

        .card-status-dot.abandoned {
            background-color: #95a5a6;
        }

        .card-menu {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background-color: rgba(0, 0, 0, 0.7);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .card:hover .card-menu {
            opacity: 1;
        }

        .menu-dots {
            font-size: 1.2rem;
            color: white;
        }

        .menu-options {
            position: absolute;
            top: 2.5rem;
            right: 0;
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            z-index: 10;
            display: none;
            min-width: 150px;
        }

        .menu-option {
            padding: 0.75rem 1rem;
            cursor: pointer;
            white-space: nowrap;
            transition: background-color 0.2s;
        }

        .menu-option:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .menu-option.delete {
            color: var(--danger-color);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            overflow-y: auto;
            margin: 1rem;
        }

        .modal-header {
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group.hidden {
            display: none;
        }

        .form-group.hidden.show {
            display: block;
        }

        .status-radio-group {
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .status-radio {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
        }

        .status-radio input[type="radio"] {
            cursor: pointer;
        }

        .category-select {
            width: 100%;
            padding: 0.75rem;
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--border-radius);
            color: var(--text-color);
            font-size: 1rem;
        }

        .category-select:focus {
            outline: none;
            border-color: var(--accent-color);
        }

        .category-select option {
            background-color: var(--card-bg);
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .form-input {
            width: 100%;
            padding: 0.75rem;
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--border-radius);
            color: var(--text-color);
            font-size: 1rem;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--accent-color);
        }

        .image-preview {
            width: 100%;
            aspect-ratio: 1;
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: var(--border-radius);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            margin-top: 0.5rem;
        }

        .preview-image {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.3s;
        }

        .btn-primary {
            background-color: var(--accent-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--hover-color);
        }

        .btn-secondary {
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--text-color);
        }

        .btn-secondary:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        @media (max-width: 768px) {
            .cards-container {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }
            
            header {
                padding: 1rem;
                flex-wrap: wrap;
            }
            
            .header-left {
                flex-wrap: wrap;
                gap: 0.5rem;
            }
            
            .status-filter-buttons {
                gap: 0.25rem;
            }
            
            .status-filter-btn {
                padding: 0.4rem 0.8rem;
                font-size: 0.9rem;
            }
            
            .modal-content {
                width: 95%;
                padding: 1rem;
                max-height: 95vh;
            }
        }

        @media (max-width: 480px) {
            .cards-container {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
            
            .status-filter-btn {
                padding: 0.3rem 0.6rem;
                font-size: 0.8rem;
            }
            
            .status-indicator {
                width: 6px;
                height: 6px;
                margin-right: 0.3rem;
            }
            
            .modal-content {
                width: 98%;
                padding: 0.75rem;
            }
            
            .form-group {
                margin-bottom: 1rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-left">
            <a href="#" class="logo">
                <svg class="logo-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <linearGradient id="giftGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#ff6b9d;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#c44569;stop-opacity:1" />
                        </linearGradient>
                    </defs>
                    <rect x="20" y="35" width="60" height="50" fill="url(#giftGrad)" rx="5"/>
                    <rect x="20" y="35" width="60" height="15" fill="#ffd700" rx="5"/>
                    <line x1="50" y1="35" x2="50" y2="85" stroke="#fff" stroke-width="3"/>
                    <line x1="20" y1="50" x2="80" y2="50" stroke="#fff" stroke-width="3"/>
                    <circle cx="35" cy="25" r="8" fill="#ff6b9d"/>
                    <circle cx="65" cy="25" r="8" fill="#ff6b9d"/>
                    <path d="M 35 25 Q 50 15 65 25" stroke="#ff6b9d" stroke-width="2" fill="none"/>
                </svg>
                <span>wList</span>
            </a>
            <div class="status-filter-buttons">
                <button class="status-filter-btn" id="filterAll" data-status="all">
                    <span class="status-indicator"></span>–í—Å–µ
                </button>
                <button class="status-filter-btn" id="filterActive" data-status="active">
                    <span class="status-indicator active"></span>Active
                </button>
                <button class="status-filter-btn" id="filterCompleted" data-status="completed">
                    <span class="status-indicator completed"></span>Completed
                </button>
                <button class="status-filter-btn" id="filterAbandoned" data-status="abandoned">
                    <span class="status-indicator abandoned"></span>Abandoned
                </button>
            </div>
            <button class="hidden-btn" id="hiddenBtn"></button>
            <button class="header-btn" id="publishBtn" style="display: none;">üì§ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
        </div>
    </header>

    <main>
        <div id="mainContainer">
            
        </div>
    </main>

    <div class="modal" id="cardModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É</h2>
            </div>
            <form id="cardForm">
                <div class="form-group">
                    <label for="cardName" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                    <input type="text" id="cardName" class="form-input" required>
                </div>
                <div class="form-group">
                    <label for="cardUrl" class="form-label">–°—Å—ã–ª–∫–∞</label>
                    <input type="url" id="cardUrl" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">–°—Ç–∞—Ç—É—Å</label>
                    <div class="status-radio-group">
                        <label class="status-radio">
                            <input type="radio" name="cardStatus" value="active" checked>
                            <span class="status-indicator active"></span>
                            <span>Active</span>
                        </label>
                        <label class="status-radio">
                            <input type="radio" name="cardStatus" value="completed">
                            <span class="status-indicator completed"></span>
                            <span>Completed</span>
                        </label>
                        <label class="status-radio">
                            <input type="radio" name="cardStatus" value="abandoned">
                            <span class="status-indicator abandoned"></span>
                            <span>Abandoned</span>
                        </label>
                    </div>
                </div>
                <div class="form-group">
                    <label for="cardImage" class="form-label">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (URL)</label>
                    <input type="url" id="cardImage" class="form-input" placeholder="https://example.com/image.jpg">
                    <div class="image-preview" id="imagePreview">
                        <span>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</span>
                    </div>
                </div>
                <div class="form-group hidden" id="priceGroup">
                    <label for="cardPrice" class="form-label">–°—Ç–æ–∏–º–æ—Å—Ç—å</label>
                    <input type="number" id="cardPrice" class="form-input" step="0.01" min="0" placeholder="0.00">
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" id="cancelBtn">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-primary" id="saveBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </form>
        </div>
    </div>

    
    <div class="modal" id="passwordModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å</h2>
            </div>
            <form id="passwordForm">
                <div class="form-group">
                    <input type="password" id="passwordInput" class="form-input" placeholder="–ü–∞—Ä–æ–ª—å" required autofocus>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" id="passwordCancelBtn">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-primary">–í–æ–π—Ç–∏</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const mainContainer = document.getElementById('mainContainer');
            const cardModal = document.getElementById('cardModal');
            const passwordModal = document.getElementById('passwordModal');
            const cardForm = document.getElementById('cardForm');
            const passwordForm = document.getElementById('passwordForm');
            const modalTitle = document.getElementById('modalTitle');
            const cardName = document.getElementById('cardName');
            const cardUrl = document.getElementById('cardUrl');
            const cardImage = document.getElementById('cardImage');
            const cardPrice = document.getElementById('cardPrice');
            const priceGroup = document.getElementById('priceGroup');
            const imagePreview = document.getElementById('imagePreview');
            const cancelBtn = document.getElementById('cancelBtn');
            const saveBtn = document.getElementById('saveBtn');
            const hiddenBtn = document.getElementById('hiddenBtn');
            const filterAll = document.getElementById('filterAll');
            const filterActive = document.getElementById('filterActive');
            const filterCompleted = document.getElementById('filterCompleted');
            const filterAbandoned = document.getElementById('filterAbandoned');
            const logo = document.querySelector('.logo');
            
            let cards = JSON.parse(localStorage.getItem('wListCards')) || [];
            let editingCardIndex = null;
            let currentFilter = 'all';
            let priceModeActive = false;
            let isModalOpen = false;

            let secretClickCount = 0;
            let secretClickTimer = null;

            const GITHUB_CONFIG = {
                owner: 'YuKanNaKirikabu',
                repo: 'wList.github.io',
                dataFile: 'data.json',
                branch: 'main'
            };
            
            const publishBtn = document.getElementById('publishBtn');
            
            const categoryOrder = ['legendary', 'epic', 'rare', 'uncommon', 'common'];
            const categoryNames = {
                legendary: 'Legendary',
                epic: 'Epic',
                rare: 'Rare',
                uncommon: 'Uncommon',
                common: 'Common'
            };
            const categoryColors = {
                legendary: 'var(--legendary-color)',
                epic: 'var(--epic-color)',
                rare: 'var(--rare-color)',
                uncommon: 'var(--uncommon-color)',
                common: 'var(--common-color)'
            };

            // –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
            console.log('imagePreview:', imagePreview);
            console.log('cardModal:', cardModal);
            console.log('–í—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã');

            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            function openModal(modal) {
                isModalOpen = true;
                modal.style.display = 'flex';
                document.body.style.overflow = 'hidden';
            }

            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            function closeModal(modal) {
                isModalOpen = false;
                modal.style.display = 'none';
                document.body.style.overflow = '';
            }

            function getCategoryByPrice(price, existingCategory) {
                if (!price || price === '' || price === '0' || !priceModeActive) {
                    return existingCategory || 'common';
                }
                
                const priceNum = parseFloat(price);
                if (isNaN(priceNum) || priceNum <= 0) {
                    return existingCategory || 'common';
                }

                if (priceNum > 5000) {
                    return 'legendary';
                } else if (priceNum > 1000) {
                    return 'epic';
                } else if (priceNum > 500) {
                    return 'rare';
                } else if (priceNum > 250) {
                    return 'uncommon';
                } else {
                    return 'common';
                }
            }

            function loadCards() {
                mainContainer.innerHTML = '';

                let filteredCards = cards;
                if (currentFilter !== 'all') {
                    filteredCards = cards.filter(card => card.status === currentFilter);
                }

                const cardsByCategory = {};
                categoryOrder.forEach(cat => {
                    cardsByCategory[cat] = filteredCards.filter(card => card.category === cat);
                });

                const displayCardsByCategory = {};
                const cardsWithoutPrice = [];
                
                categoryOrder.forEach(cat => {
                    const categoryCards = cardsByCategory[cat];
                    const withPrice = [];
                    const withoutPrice = [];
                    
                    categoryCards.forEach((card, idx) => {
                        const hasPrice = card.price && card.price !== '0' && parseFloat(card.price) > 0;
                        if (hasPrice) {
                            withPrice.push(card);
                        } else {
                            const cardCopy = {...card};
                            cardCopy.originalCategory = cat;
                            cardCopy.originalIndex = cards.findIndex(c => 
                                c.name === card.name && c.url === card.url && c.category === cat
                            );
                            withoutPrice.push(cardCopy);
                        }
                    });
                    
                    if (cat === 'common') {
                        displayCardsByCategory[cat] = [...withPrice, ...withoutPrice];
                    } else {
                        displayCardsByCategory[cat] = withPrice;
                        withoutPrice.forEach(card => {
                            cardsWithoutPrice.push(card);
                        });
                    }
                });

                if (cardsWithoutPrice.length > 0) {
                    cardsWithoutPrice.sort((a, b) => {
                        const dateA = a.createdAt || 0;
                        const dateB = b.createdAt || 0;
                        return dateA - dateB;
                    });
                    displayCardsByCategory['common'] = [...(displayCardsByCategory['common'] || []), ...cardsWithoutPrice];
                }

                categoryOrder.forEach(cat => {
                    const categoryCards = displayCardsByCategory[cat] || [];
                    categoryCards.sort((a, b) => {
                        const priceA = parseFloat(a.price) || 0;
                        const priceB = parseFloat(b.price) || 0;
                        const hasPriceA = a.price && a.price !== '0' && parseFloat(a.price) > 0;
                        const hasPriceB = b.price && b.price !== '0' && parseFloat(b.price) > 0;

                        if (hasPriceA && hasPriceB) {
                            return priceB - priceA;
                        }

                        if (hasPriceA && !hasPriceB) return -1;
                        if (!hasPriceA && hasPriceB) return 1;

                        const dateA = a.createdAt || 0;
                        const dateB = b.createdAt || 0;
                        return dateA - dateB;
                    });
                    displayCardsByCategory[cat] = categoryCards;
                });

                const categorySections = [];
                categoryOrder.forEach(category => {
                    const categoryCards = displayCardsByCategory[category] || [];

                    if (categoryCards.length === 0 && currentFilter !== 'all') {
                        return;
                    }
                    
                    const categorySection = document.createElement('div');
                    categorySection.className = 'category-section';
                    
                    const categoryHeader = document.createElement('div');
                    categoryHeader.className = `category-header ${category}`;
                    
                    const categoryTitle = document.createElement('span');
                    categoryTitle.textContent = categoryNames[category];
                    
                    const categoryTotal = document.createElement('span');
                    categoryTotal.className = 'category-total';
                    if (priceModeActive) {
                        const total = categoryCards.reduce((sum, card) => sum + (parseFloat(card.price) || 0), 0);
                        categoryTotal.textContent = `–ò—Ç–æ–≥–æ: ${total.toFixed(2)} ‚ÇΩ`;
                    }
                    categoryHeader.appendChild(categoryTitle);
                    categoryHeader.appendChild(categoryTotal);
                    
                    const cardsContainer = document.createElement('div');
                    cardsContainer.className = 'cards-container';
                    
                    categoryCards.forEach((card, index) => {
                        let originalIndex = -1;
                        if (card.originalIndex !== undefined) {
                            originalIndex = card.originalIndex;
                        } else {
                            originalIndex = cards.findIndex(c => 
                                c.name === card.name && 
                                c.url === card.url && 
                                c.category === (card.originalCategory || card.category)
                            );
                        }
                        if (originalIndex === -1) {
                            originalIndex = cards.indexOf(card);
                        }
                        const cardElement = createCardElement(card, originalIndex);
                        cardsContainer.appendChild(cardElement);
                    });
                    
                    categorySection.appendChild(categoryHeader);
                    categorySection.appendChild(cardsContainer);
                    mainContainer.appendChild(categorySection);
                    categorySections.push(categorySection);
                });

                if (currentFilter === 'all') {
                    const addCardSection = document.createElement('div');
                    addCardSection.className = 'category-section';
                    
                    const addCardContainer = document.createElement('div');
                    addCardContainer.className = 'cards-container';
                    addCardContainer.style.justifyContent = 'flex-start';
                    
                    const addCard = document.createElement('div');
                    addCard.className = 'card card-add';
                    addCard.id = 'addCard-main';
                    const plusIcon = document.createElement('div');
                    plusIcon.className = 'plus-icon';
                    plusIcon.textContent = '+';
                    addCard.appendChild(plusIcon);
                    
                    // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
                    addCard.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        hideAllMenus();
                        editingCardIndex = null;
                        modalTitle.textContent = '–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É';
                        cardForm.reset();
                        document.querySelector('input[name="cardStatus"][value="active"]').checked = true;
                        
                        // –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É
                        if (imagePreview) {
                            imagePreview.innerHTML = '<span>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</span>';
                        }
                        
                        if (priceModeActive) {
                            priceGroup.classList.add('show');
                            cardPrice.value = '';
                        } else {
                            priceGroup.classList.remove('show');
                        }
                        openModal(cardModal);
                    });
                    
                    addCardContainer.appendChild(addCard);
                    addCardSection.appendChild(addCardContainer);
                    mainContainer.appendChild(addCardSection);
                }
            }

            function createCardElement(card, index) {
                const cardElement = document.createElement('div');
                cardElement.className = 'card';
                cardElement.dataset.index = index;
                
                const cardLink = document.createElement('a');
                cardLink.href = card.url;
                cardLink.className = 'card-link';
                cardLink.target = '_blank';
                
                const cardImage = document.createElement('img');
                cardImage.src = card.image || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjMzMzMzMzIi8+CjxwYXRoIGQ9Ik04MCA2MEgxMjBWODBIMTQwVjYwSDE2MFYxMDBIMTQwVjEyMEgxMjBWMTQwSDgwVjEyMEg2MFYxMDBIODBWODBINjBWNjBIODBaIiBmaWxsPSIjNTU1NTU1Ii8+Cjwvc3ZnPgo=';
                cardImage.alt = card.name;
                cardImage.className = 'card-image';
                
                const cardTitle = document.createElement('div');
                cardTitle.className = 'card-title';

                const statusDot = document.createElement('div');
                statusDot.className = `card-status-dot ${card.status || 'active'}`;
                cardTitle.appendChild(statusDot);
                
                const titleText = document.createElement('span');
                titleText.textContent = card.name;
                cardTitle.appendChild(titleText);
                
                const cardMenu = document.createElement('div');
                cardMenu.className = 'card-menu';
                
                const menuDots = document.createElement('div');
                menuDots.className = 'menu-dots';
                menuDots.textContent = '‚ãØ';
                
                const menuOptions = document.createElement('div');
                menuOptions.className = 'menu-options';
                
                const editOption = document.createElement('div');
                editOption.className = 'menu-option';
                editOption.textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å';
                editOption.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    hideAllMenus();
                    openEditModal(index);
                });
                
                const deleteOption = document.createElement('div');
                deleteOption.className = 'menu-option delete';
                deleteOption.textContent = '–£–¥–∞–ª–∏—Ç—å';
                deleteOption.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    deleteCard(index);
                });
                
                menuOptions.appendChild(editOption);
                menuOptions.appendChild(deleteOption);
                cardMenu.appendChild(menuDots);
                cardMenu.appendChild(menuOptions);
                
                cardLink.appendChild(cardImage);
                cardLink.appendChild(cardTitle);
                cardElement.appendChild(cardLink);
                cardElement.appendChild(cardMenu);

                cardMenu.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    const isVisible = menuOptions.style.display === 'block';
                    hideAllMenus();
                    if (!isVisible) {
                        menuOptions.style.display = 'block';

                        const rect = menuOptions.getBoundingClientRect();
                        const viewportWidth = window.innerWidth;
                        if (rect.right > viewportWidth) {
                            const offset = rect.right - viewportWidth + 10;
                            menuOptions.style.right = 'auto';
                            menuOptions.style.left = `${-offset}px`;
                        } else {
                            menuOptions.style.right = '0';
                            menuOptions.style.left = 'auto';
                        }
                    }
                });
                
                return cardElement;
            }

            function hideAllMenus() {
                document.querySelectorAll('.menu-options').forEach(menu => {
                    menu.style.display = 'none';
                });
            }

            function setActiveFilter(status) {
                currentFilter = status;
                filterAll.classList.remove('active');
                filterActive.classList.remove('active');
                filterCompleted.classList.remove('active');
                filterAbandoned.classList.remove('active');
                
                if (status === 'all') {
                    filterAll.classList.add('active');
                } else if (status === 'active') {
                    filterActive.classList.add('active');
                } else if (status === 'completed') {
                    filterCompleted.classList.add('active');
                } else if (status === 'abandoned') {
                    filterAbandoned.classList.add('active');
                }
                
                loadCards();
            }
            
            filterAll.addEventListener('click', () => setActiveFilter('all'));
            filterActive.addEventListener('click', () => setActiveFilter('active'));
            filterCompleted.addEventListener('click', () => setActiveFilter('completed'));
            filterAbandoned.addEventListener('click', () => setActiveFilter('abandoned'));

            logo.addEventListener('click', function(e) {
                e.preventDefault();
                setActiveFilter('all');
            });

            setActiveFilter('all');

            function openEditModal(index) {
                editingCardIndex = index;
                const card = cards[index];
                modalTitle.textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É';
                cardName.value = card.name;
                cardUrl.value = card.url;
                cardImage.value = card.image || '';

                const statusRadio = document.querySelector(`input[name="cardStatus"][value="${card.status || 'active'}"]`);
                if (statusRadio) {
                    statusRadio.checked = true;
                }

                if (priceModeActive) {
                    priceGroup.classList.add('show');
                    cardPrice.value = card.price || '';
                } else {
                    priceGroup.classList.remove('show');
                }
                
                // –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É
                if (card.image && imagePreview) {
                    updateImagePreview(card.image);
                } else if (imagePreview) {
                    imagePreview.innerHTML = '<span>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</span>';
                }
                
                setTimeout(() => {
                    openModal(cardModal);
                }, 10);
            }

            cardImage.addEventListener('input', function() {
                if (cardImage.value) {
                    updateImagePreview(cardImage.value);
                } else {
                    if (imagePreview) {
                        imagePreview.innerHTML = '<span>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</span>';
                    }
                }
            });
            
            function updateImagePreview(url) {
                if (!imagePreview) {
                    console.error('imagePreview not found');
                    return;
                }
                imagePreview.innerHTML = '';
                const img = document.createElement('img');
                img.src = url;
                img.className = 'preview-image';
                img.onerror = function() {
                    imagePreview.innerHTML = '<span>–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</span>';
                };
                imagePreview.appendChild(img);
            }

            cardForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const statusValue = document.querySelector('input[name="cardStatus"]:checked').value;
                const priceValue = priceModeActive ? (cardPrice.value || '0') : null;

                let existingCategory = null;
                if (editingCardIndex !== null) {
                    existingCategory = cards[editingCardIndex].category;
                }
                const category = getCategoryByPrice(priceValue, existingCategory);
                
                const newCard = {
                    name: cardName.value,
                    url: cardUrl.value,
                    image: cardImage.value || null,
                    category: category,
                    status: statusValue,
                    price: priceValue,
                    createdAt: editingCardIndex !== null ? cards[editingCardIndex].createdAt || Date.now() : Date.now()
                };
                
                if (editingCardIndex !== null) {
                    cards[editingCardIndex] = newCard;
                } else {
                    cards.push(newCard);
                }
                
                localStorage.setItem('wListCards', JSON.stringify(cards));
                loadCards();
                closeModal(cardModal);
            });

            function deleteCard(index) {
                if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –∫–∞—Ä—Ç–æ—á–∫—É?')) {
                    cards.splice(index, 1);
                    localStorage.setItem('wListCards', JSON.stringify(cards));
                    loadCards();
                }
            }

            cancelBtn.addEventListener('click', function() {
                closeModal(cardModal);
            });

            window.addEventListener('click', function(e) {
                if (e.target === cardModal) {
                    closeModal(cardModal);
                }
                if (e.target === passwordModal) {
                    closeModal(passwordModal);
                    passwordForm.reset();
                }
            });

            document.addEventListener('click', function(e) {
                if (isModalOpen) return;
                
                if (!e.target.closest('.card-menu') && !e.target.closest('.modal')) {
                    hideAllMenus();
                }
            });

            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    if (cardModal.style.display === 'flex') {
                        closeModal(cardModal);
                    }
                    if (passwordModal.style.display === 'flex') {
                        closeModal(passwordModal);
                        passwordForm.reset();
                    }
                }
            });

            hiddenBtn.addEventListener('click', function() {
                if (priceModeActive) {
                    priceModeActive = false;
                    priceGroup.classList.remove('show');
                    publishBtn.style.display = 'none';
                    loadCards();
                    secretClickCount = 0;
                    if (secretClickTimer) {
                        clearTimeout(secretClickTimer);
                        secretClickTimer = null;
                    }
                } else {
                    secretClickCount++;

                    if (secretClickTimer) {
                        clearTimeout(secretClickTimer);
                    }

                    if (secretClickCount >= 3) {
                        secretClickCount = 0;
                        openModal(passwordModal);
                        document.getElementById('passwordInput').focus();
                    } else {
                        secretClickTimer = setTimeout(function() {
                            secretClickCount = 0;
                            secretClickTimer = null;
                        }, 5000);
                    }
                }
            });

            passwordForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const password = document.getElementById('passwordInput').value;
                if (password === '0119') {
                    priceModeActive = true;
                    priceGroup.classList.add('show');
                    closeModal(passwordModal);
                    passwordForm.reset();

                    checkGitHubOwner().then(isOwner => {
                        if (isOwner) {
                            publishBtn.style.display = 'block';
                        }
                    });
                    loadCards();
                } else {
                    alert('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å');
                    document.getElementById('passwordInput').value = '';
                }
            });
            
            document.getElementById('passwordCancelBtn').addEventListener('click', function() {
                closeModal(passwordModal);
                passwordForm.reset();
            });

            async function loadPublishedData() {
                try {
                    const response = await fetch(`https://raw.githubusercontent.com/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/${GITHUB_CONFIG.branch}/${GITHUB_CONFIG.dataFile}`);
                    if (response.ok) {
                        const data = await response.json();
                        if (data.items && data.items.length > 0) {
                            const githubCards = data.items.map(item => ({
                                name: item.title || item.name,
                                url: item.website || item.url,
                                image: item.image,
                                category: item.category || 'common',
                                status: item.status || 'active',
                                price: item.price || null,
                                createdAt: item.createdAt || Date.now()
                            }));

                            const localCards = JSON.parse(localStorage.getItem('wListCards')) || [];
                            const mergedCards = [...githubCards];

                            localCards.forEach(localCard => {
                                const exists = mergedCards.some(gc => 
                                    gc.name === localCard.name && gc.url === localCard.url
                                );
                                if (!exists) {
                                    mergedCards.push(localCard);
                                }
                            });
                            
                            cards = mergedCards;
                            localStorage.setItem('wListCards', JSON.stringify(cards));
                            loadCards();
                        }
                    }
                } catch (error) {
                    console.log('GitHub –¥–∞–Ω–Ω—ã–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã, –∏—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ');
                }
            }

            async function checkGitHubOwner() {
                try {
                    const response = await fetch(`https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}`);
                } catch (error) {
                    return false;
                }
                return true;
            }

            async function publishToGitHub() {
                const token = prompt('–í–≤–µ–¥–∏—Ç–µ –≤–∞—à GitHub Personal Access Token:');
                if (!token) {
                    return;
                }
                
                try {
                    const publishData = {
                        lastUpdated: new Date().toISOString(),
                        items: cards.map(card => ({
                            title: card.name,
                            website: card.url,
                            image: card.image,
                            category: card.category,
                            status: card.status,
                            price: card.price,
                            createdAt: card.createdAt
                        }))
                    };

                    let sha = null;
                    try {
                        const getResponse = await fetch(`https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${GITHUB_CONFIG.dataFile}`, {
                            headers: {
                                'Authorization': `token ${token}`
                            }
                        });
                        if (getResponse.ok) {
                            const fileData = await getResponse.json();
                            sha = fileData.sha;
                        }
                    } catch (e) {
                    }

                    const updateResponse = await fetch(`https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${GITHUB_CONFIG.dataFile}`, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `token ${token}`,
                            'Content-Type': 'application/json',
                            'Accept': 'application/vnd.github.v3+json'
                        },
                        body: JSON.stringify({
                            message: `Update data ${new Date().toISOString()}`,
                            content: btoa(unescape(encodeURIComponent(JSON.stringify(publishData, null, 2)))),
                            sha: sha,
                            branch: GITHUB_CONFIG.branch
                        })
                    });
                    
                    if (updateResponse.ok) {
                        alert('‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω—ã –Ω–∞ GitHub!');
                        await loadPublishedData();
                    } else {
                        const errorData = await updateResponse.json();
                        throw new Error(errorData.message || '–û—à–∏–±–∫–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏');
                    }
                } catch (error) {
                    alert('‚ùå –û—à–∏–±–∫–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏: ' + error.message);
                }
            }

            publishBtn.addEventListener('click', publishToGitHub);

            loadPublishedData().then(() => {
                if (cards.length === 0) {
                    loadCards();
                }
            });
        });
    </script>
</body>
</html>
